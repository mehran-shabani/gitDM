## سناریو کامل اپلیکیشن

پلتفرم «Helssa Diabetes Pilot» یک سامانه‌ی یکپارچه مدیریت بیماران دیابتی است که سه بازیگر اصلی دارد: پزشک، بیمار و موتور هوش‌مصنوعی. داده‌های خام کلینیکی (مواجهات، آزمایشگاه، تجویزها) از زیرسیستم‌­های مستقل وارد می‌شوند و در پایگاه مرکزی ذخیره می‌گردند. پزشک تنها به بیماران تحت پوشش خود دسترسی دارد و می‌تواند تاریخچه‌ٔ یکپارچهٔ بیمار را در قالب «Timeline» مشاهده کند؛ موتور AI به‌صورت غیرفعال روی این داده‌­ها پردازش انجام داده و خلاصه‌­های تحلیلی (AISummary) تولید می‌کند تا تصمیم‌گیری سریع‌تر و مبتنی بر شواهد شود.

چرخهٔ کلی کاربر:
1. پزشک با JWT احراز هویت می‌شود.
2. بیمارانِ نگاشت شده به عنوان `primary_doctor` بارگیری می‌شوند.
3. پزشک از طریق اندپوینت `/patient/:id/timeline/` مجموعه داده‌های بالینی + خلاصه‌های AI را دریافت می‌کند.
4. اقدامات تکمیلی (تجویز جدید، درخواست آزمایش) از طریق زیرسیستم‌­های مربوط ثبت می‌شود و مجدداً در تایم‌لاین بازتاب می‌یابد.

## ارزیابی «Review Server» نسبت به انتظارات GitDM

| مورد | پیکربندی فعلی | کفایت برای GitDM | توضیح |
|------|---------------|------------------|--------|
| جلوگیری از تغییر فایل در PR | `mode: comments_only` و `forbidden_actions` | ✅ کافی است | GitDM صرفاً نیازمند بررسی سبک کد و عدم تغییر خودکار است. |
| تمرکز روی فایل‌های `should-*` در فازها | قانون `only_should_files` + `phase_scope_only` | ✅ مطابق انتظار | از انتشار بررسی خارج از محدوده جلوگیری می‌شود. |
| سازگاری با Helssa | قانون `helssa_compatibility` | ⚠️ بخشی‌ از نیازها را پوشش می‌دهد | این قانون کلی است؛ قواعد دقیق‌تر (نام‌گذاری namespace، نسخه پایگاه‌داده) باید مشخص شوند. |
| بررسی امنیتی و RBAC | تعریف شده در «phase-07-security» | ❌ ناکافی | صرفاً ذکر فاز وجود دارد؛ هیچ Rule عملیاتی برای اسکن آسیب‌پذیری یا تست پرمیشن‌ها تعریف نشده است. |
| یکپارچگی تست‌ها | «phase-08-testflow» | ❌ ناکافی | Rule خاصی برای اطمینان از وجود تست یا پوشش تعریف نشده است. |

### جمع‌بندی
Review Server بخش عمده‌ای از نیازمندی‌های GitDM (کنترل دامنه تغییرات، فازبندی، ممنوعیت تغییر فایل، سازگاری با Helssa) را برآورده می‌کند؛ با این حال در حوزه امنیت و تضمین کیفیت (تست و استانداردهای namespace) نیاز به Rules و چک‌های تکمیلی است.

## پیشنهادات بهبود
1. افزودن Rule «security_static_scan» برای اجرای خودکار Bandit/Trivy بر روی کد تغییر یافته و گزارش در PR.
2. تعریف Rule «test_coverage_threshold» با الزام حداقل 80٪ پوشش در فاز 08. استفاده از Coverage.py و افزونه GitHub.
3. گسترش «helssa_compatibility» با چک خودکار ماژول‌­های Python جهت تطابق با `helssa.*` namespace و نسخه‌های مجاز.
4. ایجاد Rule «migration_safety» در فاز مدل‌ها برای اطمینان از عدم حذف ستون یا عملیات مخرب.

## سناریوی کوتاه برای ویژگی جدید
«داشبورد پیش‌بینی ریسک هیپوگلیسمی»: سیستم با تحلیل روند گلوکز، دارو و زمان‌بندی وعده‌ها احتمال وقوع هیپوگلیسمی در 24 ساعت آینده را پیش‌بینی کرده و به پزشک هشدار می‌دهد.