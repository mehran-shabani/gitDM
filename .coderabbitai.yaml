version: 1
project:
  name: Diabetes Pilot (Helssa continuation)
  language: python
  frameworks: [django, drf, celery]
  default_branch: develop
review:
  mode: comments_only  # ÙÙ‚Ø· Ú©Ø§Ù…Ù†Øª Ø¯Ø± PRØŒ Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ± Ú©Ø¯
  trigger: pull_request  # ÙÙ‚Ø· Ø¯Ø± pull request ÙØ¹Ø§Ù„
  auto_review: true
  comment_format: structured  # Ú©Ø§Ù…Ù†Øªâ€ŒÙ‡Ø§ÛŒ Ø³Ø§Ø®ØªØ§Ø±ÛŒØ§ÙØªÙ‡
  summary:
    enabled: true
    format: pr_comment  # Ø®Ù„Ø§ØµÙ‡ Ø¨Ù‡ ØµÙˆØ±Øª Ú©Ø§Ù…Ù†Øª Ø¯Ø± PR
  issues:
    enabled: true
    format: pr_comment  # Ù…Ø´Ú©Ù„Ø§Øª Ø¨Ù‡ ØµÙˆØ±Øª Ú©Ø§Ù…Ù†Øª Ø¯Ø± PR
  checklists:
    enabled: true
    format: pr_comment  # Ú†Ú©â€ŒÙ„ÛŒØ³Øª Ø¨Ù‡ ØµÙˆØ±Øª Ú©Ø§Ù…Ù†Øª Ø¯Ø± PR
rules:
  - id: scope-limits
    description: ØªØºÛŒÛŒØ± ÙÙ‚Ø· Ø¯Ø± ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ÙØ§Ø² ÙØ¹Ø§Ù„
    severity: error
    include:
      - phases/**
      - cursoragent/**
      - api/**
      - apps/**
      - config/**
      - tests/**
    exclude:
      - '**/*.md'
      - '**/.env*'
  - id: follow-should-files
    description: Ù‡Ù…Ù‡Ù” Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒâ€ŒÙ‡Ø§ Ø¨Ø§ÛŒØ¯ Ù…Ø·Ø§Ø¨Ù‚ should-* Ø¨Ø§Ø´Ù†Ø¯
    severity: error
  - id: no-central-url-change
    description: ØªØºÛŒÛŒØ± URL/Router Ù…Ø±Ú©Ø²ÛŒ Ø®Ø§Ø±Ø¬ Ø§Ø² Ù…Ø­Ø¯ÙˆØ¯Ù‡Ù” ÙØ§Ø² Ù…Ù…Ù†ÙˆØ¹
    severity: error
  - id: tests-required
    description: ÙˆØ¬ÙˆØ¯ Ùˆ Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø§Ù„Ø²Ø§Ù…ÛŒ Ù‡Ø± ÙØ§Ø²
    severity: warning
outputs:
  on_pr_only: true  # ÙÙ‚Ø· Ø¯Ø± PR
  comment_templates:
    summary: |
      ## ğŸ“‹ Summary â€“ {{phase}}
      **Branch:** `{{branch_name}}`
      **Scope:** {{affected_files}}
      **Architecture:** {{architecture_overview}}
      **Key Decisions:** {{important_decisions}}
      **Helssa Compatibility:** {{compatibility_status}}
      **Risks:** {{identified_risks}}
      **Suggestions:** {{improvement_suggestions}}
    
    issues: |
      ## âš ï¸ Issues Found â€“ {{phase}}
      {{#each issues}}
      - **{{severity}}** in `{{file}}:{{line}}` - {{description}}
        - Rule: `{{rule}}`
        - Reference: {{reference}}
      {{/each}}
    
    helssa_compat: |
      ## ğŸ”— Helssa Compatibility Check â€“ {{phase}}
      - âœ…/âŒ Namespaceâ€ŒÙ‡Ø§ Ù…Ø·Ø§Ø¨Ù‚ Ø§Ù„Ú¯ÙˆÛŒ Helssa
      - âœ…/âŒ URLâ€ŒÙ‡Ø§ÛŒ Ù…Ø±Ú©Ø²ÛŒ ØªØºÛŒÛŒØ± Ù†Ú©Ø±Ø¯Ù‡â€ŒØ§Ù†Ø¯  
      - âœ…/âŒ Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ø¯Ù‡ Ø¨Ø§ Helssa ØªØ¹Ø§Ø±Ø¶ Ù†Ø¯Ø§Ø±Ù†Ø¯
      - âœ…/âŒ Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ù…Ø­ÛŒØ·ÛŒ Ø¯Ø± Ø¬Ø§ÛŒ Ù…Ù†Ø§Ø³Ø¨
      - âœ…/âŒ Ù„Ø§Ú¯â€ŒÙ‡Ø§ Ùˆ ØªØ³Øªâ€ŒÙ‡Ø§ Ø¯Ø± Ù…Ø³ÛŒØ± ØµØ­ÛŒØ­
      - âœ…/âŒ Migrationâ€ŒÙ‡Ø§ backward compatible Ù‡Ø³ØªÙ†Ø¯
      - âœ…/âŒ APIâ€ŒÙ‡Ø§ Ø¨Ø§ conventions Ù…ÙˆØ¬ÙˆØ¯ Ø³Ø§Ø²Ú¯Ø§Ø±Ù†Ø¯
      
      **Critical Notes:** {{critical_notes}}
      **Integration Recommendations:** {{integration_recommendations}}

policies:
  external_sources: deny
  prompt_conflicts:
    action: stop
    report: cursoragent/PARADOX_REPORT.md
labels:
  required:
    - cursor-agent
    - phase-xx

# CodeRabbit Agent Instructions - ÙÙ‚Ø· Ú©Ø§Ù…Ù†Øª Ø¯Ø± PR
agent_instructions: |
  # CodeRabbit Review Agent â€“ Ø¯Ø³ØªÙˆØ±Ø§Ù„Ø¹Ù…Ù„ Ú©Ø§Ù…Ù†Øª Ø¯Ø± PR

  ## âš ï¸ Ù…Ù‡Ù…: ÙÙ‚Ø· Ú©Ø§Ù…Ù†Øª Ø¯Ø± Pull Request
  - Ù‡ÛŒÚ† ÙØ§ÛŒÙ„ÛŒ Ø§ÛŒØ¬Ø§Ø¯ ÛŒØ§ ØªØºÛŒÛŒØ± Ù†Ú©Ù†
  - ÙÙ‚Ø· Ú©Ø§Ù…Ù†Øªâ€ŒÙ‡Ø§ÛŒ Ø±ÛŒÙˆÛŒÙˆ Ø¯Ø± PR Ø¨Ú¯Ø°Ø§Ø±
  - Ù‡Ø± Ø¨Ø±Ù†Ú†/ÙØ§Ø² Ø±Ø§ Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†

  ## Ù…Ù†Ø§Ø¨Ø¹ Ø§ØµÙ„ÛŒ (ÙÙ‚Ø· Ø§ÛŒÙ† Ù…Ù†Ø§Ø¨Ø¹ Ù…Ø¬Ø§Ø² Ø§Ø³Øª):
  - /phases/phase-01-setup/should-*.md
  - /phases/phase-02-models/should-*.md  
  - /phases/phase-03-versioning/should-*.md
  - /phases/phase-04-api/should-*.md
  - /phases/phase-05-ai/should-*.md
  - /phases/phase-06-references/should-*.md
  - /phases/phase-07-security/should-*.md
  - /phases/phase-08-testflow/should-*.md
  - /cursoragent/AGENT.MD

  ## Ù‚Ø§Ù„Ø¨ Ú©Ø§Ù…Ù†Øªâ€ŒÙ‡Ø§ÛŒ PR:

  ### 1. Summary Comment (Ø¯Ø± Ø¨Ø§Ù„Ø§ÛŒ PR):
  ```
  ## ğŸ“‹ CodeRabbit Review Summary
  
  **Phase:** phase-XX-name
  **Files Changed:** X files
  **Architecture Compliance:** âœ…/âŒ
  **Test Coverage:** âœ…/âŒ  
  **Helssa Compatibility:** âœ…/âŒ
  
  ### Key Findings:
  - âœ… Ú©Ø¯ Ù…Ø·Ø§Ø¨Ù‚ should-coding-code.md
  - âŒ ØªØ³Øª Ø§Ù„Ø²Ø§Ù…ÛŒ Ø¯Ø± should-test-coding-code.md Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª
  - âš ï¸ Ù…Ø¹Ù…Ø§Ø±ÛŒ Ø¯Ø± should-phase-architecture.md Ø±Ø¹Ø§ÛŒØª Ø´Ø¯Ù‡
  
  ### Helssa Integration:
  - âœ… Namespace Ù‡Ø§ Ø³Ø§Ø²Ú¯Ø§Ø±
  - âŒ URL Ù…Ø±Ú©Ø²ÛŒ ØªØºÛŒÛŒØ± Ú©Ø±Ø¯Ù‡ (Ø±ÛŒØ³Ú©)
  - âœ… Ù…Ø¯Ù„â€ŒÙ‡Ø§ compatible
  ```

  ### 2. Inline Comments (Ø±ÙˆÛŒ Ø®Ø·ÙˆØ· Ú©Ø¯):
  ```
  // ğŸ¤– CodeRabbit: Ø§ÛŒÙ† Ú©Ø¯ Ù…Ø·Ø§Ø¨Ù‚ /phases/phase-XX/should-coding-code.md Ù†ÛŒØ³Øª
  // Ù…Ø±Ø¬Ø¹: Ø¨Ø®Ø´ "## model_name/file.py" Ø¯Ø± should ÙØ§ÛŒÙ„
  // Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯: Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² UUID Ø¨Ø¬Ø§ÛŒ AutoField
  ```

  ### 3. Issue Comments (Ø¨Ø±Ø§ÛŒ Ù…Ø´Ú©Ù„Ø§Øª):
  ```
  ## âš ï¸ Issues Found
  
  | File | Line | Severity | Rule | Description |
  |------|------|----------|------|-------------|
  | models.py | 15 | error | follow-should-files | Ù…Ø¯Ù„ Patient Ù…Ø·Ø§Ø¨Ù‚ should-* Ù†ÛŒØ³Øª |
  | views.py | 23 | warning | tests-required | ØªØ³Øª ViewSet Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª |
  ```

  ## ÙØ§Ø²Ù‡Ø§ Ùˆ ØªÙ…Ø±Ú©Ø² Ø±ÛŒÙˆÛŒÙˆ:
  - **feat/phase-01-setup**: Docker, settings, dependencies
  - **feat/phase-02-models**: Ù…Ø¯Ù„â€ŒÙ‡Ø§ØŒ Ø±ÙˆØ§Ø¨Ø·ØŒ migrations  
  - **feat/phase-03-versioning**: append-onlyØŒ revert
  - **feat/phase-04-api**: ViewSetsØŒ JWTØŒ endpoints
  - **feat/phase-05-ai**: CeleryØŒ OpenAIØŒ error handling
  - **feat/phase-06-references**: referencesØŒ M2MØŒ seeding
  - **feat/phase-07-security**: RBACØŒ auditØŒ export
  - **feat/phase-08-testflow**: integration tests

  ## Ù‚ÙˆØ§Ù†ÛŒÙ† Ú©Ø§Ù…Ù†Øª:
  1. **ÙÙ‚Ø· should-* Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†** - suggestion-* Ø±Ø§Ù‡Ù†Ù…Ø§Ø³Øª
  2. **Ø§Ø±Ø¬Ø§Ø¹ Ù…Ø³ØªÙ‚ÛŒÙ…** Ø¨Ù‡ ÙØ§ÛŒÙ„ Ùˆ Ø¨Ø®Ø´ should-*
  3. **Helssa Ø³Ø§Ø²Ú¯Ø§Ø±ÛŒ** Ù‡Ù…ÛŒØ´Ù‡ Ú†Ú© Ø´ÙˆØ¯
  4. **Ú©Ø§Ù…Ù†Øª Ù…ÙÛŒØ¯** Ø¨Ø§ Ø±Ø§Ù‡â€ŒØ­Ù„ Ø¹Ù…Ù„ÛŒ
  5. **Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ± Ú©Ø¯** - ÙÙ‚Ø· Ú©Ø§Ù…Ù†Øª